{"version":3,"sources":["credentials/IosCredentials.js"],"names":["async","getExistingDistCerts","username","appleTeamId","options","distCerts","await","getExistingUserCredentials","formatDistCerts","map","usedByApps","userCredentialsId","certId","certP12","certPassword","let","serialNumber","IosCodeSigning","findP12CertSerialNumber","error","name","join","value","distCertSerialNumber","provideFullCertificate","String","getExistingPushKeys","pushKeys","formatPushKeys","apnsKeyId","apnsKeyP8","provideFullPushKey","short","type","err","certs","Api","callMethodAsync","Error","rest","split"],"mappings":"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","file":"../../credentials/IosCredentials.js","sourcesContent":["/* @flow */\n\nimport Api from '../Api';\nimport * as IosCodeSigning from '../detach/IosCodeSigning';\n\nexport type Credentials = {\n  appleId?: string,\n  password?: string,\n  teamId?: string,\n  certP12?: string,\n  certPassword?: string,\n  pushP12?: string,\n  pushPassword?: string,\n  provisioningProfile?: string,\n  enterpriseAccount?: string,\n  // These are ids on the spaceship object (implementation detail), Spaceship::Portal::Certificate\n  certId?: string,\n  pushId?: string,\n  provisioningProfileId?: string,\n};\n\nexport type CredObject = {\n  name: string,\n  value: {\n    userCredentialsId?: string,\n    serialNumber?: string,\n  },\n};\n\nexport type CredsList = Array<CredObject>;\n\nexport async function getExistingDistCerts(\n  username: string,\n  appleTeamId: string,\n  options: { provideFullCertificate?: boolean } = {}\n): Promise<?CredsList> {\n  const distCerts = await getExistingUserCredentials(username, appleTeamId, 'dist-cert');\n  return formatDistCerts(distCerts, options);\n}\n\nexport function formatDistCerts(distCerts, options) {\n  return distCerts.map(({ usedByApps, userCredentialsId, certId, certP12, certPassword }) => {\n    let serialNumber;\n    try {\n      serialNumber = IosCodeSigning.findP12CertSerialNumber(certP12, certPassword);\n    } catch (error) {\n      serialNumber = '------';\n    }\n    let name = `Serial number: ${serialNumber}`;\n    if (certId) {\n      name = `${name}, Certificate ID: ${certId}`;\n    }\n    if (usedByApps) {\n      name = `Used in apps: ${usedByApps.join(', ')} (${name})`;\n    }\n    return {\n      value: {\n        distCertSerialNumber: serialNumber,\n        ...(options.provideFullCertificate\n          ? { certP12, certId, certPassword }\n          : { userCredentialsId: String(userCredentialsId) }),\n      },\n      name,\n    };\n  });\n}\n\nexport async function getExistingPushKeys(\n  username: string,\n  appleTeamId: string,\n  options: { provideFullPushKey?: boolean } = {}\n): Promise<?CredsList> {\n  const pushKeys = await getExistingUserCredentials(username, appleTeamId, 'push-key');\n  return formatPushKeys(pushKeys, options);\n}\n\nexport function formatPushKeys(pushKeys, options) {\n  return pushKeys.map(({ usedByApps, userCredentialsId, apnsKeyId, apnsKeyP8 }) => {\n    let name = `Key ID: ${apnsKeyId}`;\n    if (usedByApps) {\n      name = `Used in apps: ${usedByApps.join(', ')} (${name})`;\n    }\n    return {\n      value: {\n        ...(options.provideFullPushKey\n          ? { apnsKeyId, apnsKeyP8 }\n          : { userCredentialsId: String(userCredentialsId) }),\n      },\n      name,\n      short: apnsKeyId,\n    };\n  });\n}\n\nasync function getExistingUserCredentials(\n  username: string,\n  appleTeamId: string,\n  type: string\n): Promise<?CredsList> {\n  const { err, certs } = await Api.callMethodAsync('getExistingUserCredentials', [], 'post', {\n    username,\n    appleTeamId,\n    type,\n  });\n\n  if (err) {\n    throw new Error('Error getting existing distribution certificates.');\n  } else {\n    return certs.map(({ usedByApps, userCredentialsId, ...rest }) => ({\n      usedByApps: usedByApps && usedByApps.split(';'),\n      userCredentialsId: String(userCredentialsId),\n      ...rest,\n    }));\n  }\n}\n"],"sourceRoot":"/@expo/xdl@56.2.1/src"}